---
layout: post
title: 使用git建立微信改稿系统
tags: 尚未解决 微信 git
categories: 微信相关

---

### 问题描述
微信稿件预览给客户，经多人修改、审核的过程中，由于修改意见多而混乱，导致过程耗时耗神，而结果易出错误。而且责任不明确。

### 项目需求
* 简单易用，并不给原来的流程带来过多麻烦（待验证）
* 不使用客户端，在微信中用网页实现（待验证）
* 记录所有人的修改，包括修改人、修改时间、修改内容（git实现）
* 修改后实时更新（待验证）
* 多人同时修改能解决冲突（git实现）
* 实现版本回退（git实现）
* 最终定稿后经尽量少的排版就可放到微信里（待验证）
* 集成一个编辑器（待定）
* 内置几种不同模板，直接省去排版过程（待定）

### 实现思路
* 需要一个版本控制工具（服务器本地git、github、自己做）
* 需要用纯文本格式保存稿件（markdown、txt）
* 需要纯文本导出为html（php：parsedown、js：markdown.js）
* word导出到使用的纯文本（暂时没解决方案，可能需要编辑手工做）
* 图片需要使用图床（微信图片素材、服务器本地文件、第三方图床）

### 方案比较
#### 版本控制
##### 服务器本地git
* 需要搭建git环境
* 需要php执行git命令行（或者有没有现成库？）
* 万一服务器故障？

##### github
* 需要账号，不可能每人一个账号使用fork，只能是单一账号利用分支
* 万一被墙？
* github api需要详细了解

##### 自己做（排除）
* 肯定不如git做得好
* 太麻烦

##### 其他
传说有本土的github？可以进一步了解，是否稳定，是否提供api

#### 文本格式
##### markdown（推荐）
* 容易导出为html
* 纯文本格式，适用于版本控制
* 图片不能直接插入，需要图床
* 编辑需要学习语法（也挺简单，总共不过十几条）
* 改稿过程中是否需要隐去语法标记？（隐去：只能改内容，不能改格式；不隐：难以解释）

##### txt
* 纯文本格式，适用于版本控制
* 无法区分小标题、正文
* 不能插入图片
* 容易从word导出到txt

##### 其他
暂无，需要进一步了解

#### 纯文本导出为html
##### php：parsedown
* 每次更改都需要重新加载页面，从服务器取全部数据，是否影响速度？
需要进一步了解。

##### js：markdown.js
* 是否运算复杂，手机执行速度恐怕不如服务器更快？
需要进一步了解。

##### 其他
无外乎前端、后端两类，主要考虑速度

#### word导出到纯文本
word格式比较复杂，如果使用markdown，就算有解决方案恐怕也难以理想。需要进一步了解。

#### 图床
##### 微信图片素材
* 直接在微信后台上传并获取链接，过程比较复杂
* 利用微信api集成，那也需要自制编辑后台，工作量略大，待定，或许有可以用的第三方编辑器或库？

##### 服务器本地文件（排除）
* 同样需要编辑后台
* 如果域名更改，之前的微信文章中图片全部失效

##### 第三方图床
* 是否稳定
* 将来是否会被微信屏蔽（已有先例，版权问题）
* 目前已知的只有国外的cloudAPP，速度不理想，国内的比较混乱

### 方案验证
* git记录修改人、修改时间、修改内容，非常完美
* git版本回退，没有问题
* git解决冲突，部分验证，添加、修改其他行不会引发冲突，修改当前行提示解决冲突，删除其他行、删除当前行需进一步验证
* 如何解决频繁切换分支？同一仓库不同账户，或者考虑同一服务器建立clone仓库？

### 参考
#### git使用
创建账户`git config --global user.name "Your Name"``git config --global user.email "email@example.com"`
创建仓库`git init`
建立分支`git checkout -b dev`
提交更改`git commit -m 'Name-desc'`
合并分支`git merge dev --no-ff`
删除分支
版本回退
查看历史`git log --graph --pretty=oneline --abbrev-commit`